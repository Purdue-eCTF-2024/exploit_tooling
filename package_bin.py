import argparse

PAGE_SIZE = 8192

APP_PAGES = 28
TOTAL_SIZE = APP_PAGES * PAGE_SIZE

"""
Package a device image for use with the bootstrapper
"""
def package_binary(bin_path, image_path):

    # Read input binaries
    with open(bin_path, "rb") as fp:
        bl_data = fp.read()

    # Pad bootloader to max size
    image_bl_pad_len = TOTAL_SIZE - len(bl_data)
    image_bl_padding = b"\xff" * image_bl_pad_len
    image_bl_data = bl_data + image_bl_padding

    # Write output binary
    with open(image_path, "wb") as fp:
        fp.write(image_bl_data)

def main():
    parser = argparse.ArgumentParser(
        prog="b01lers packager tool",
        description="package a dumped supply chain binary into a proper 224 KiB img that can be flashed",
    )

    parser.add_argument(
        "-f", "--file", required=True, help="File to package"
    )

    parser.add_argument(
        "-o", "--output", required=True, help="Output packaged file"
    )

    args = parser.parse_args()

    package_binary(args.file, args.output)

if __name__ == '__main__':
    main()
